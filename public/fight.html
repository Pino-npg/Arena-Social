<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fight Game - Pino Collection</title>
<link rel="stylesheet" href="style.css">
<style>
body {
  margin: 0;
  padding: 0;
  background-image: url('img/Arena.png');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center center;
  font-family: 'Segoe UI', Arial, sans-serif;
  color: white;
  text-align: center;
  height: 100vh;
  position: relative;
}
.overlay { background: rgba(0,0,0,0.6); position: fixed; inset:0; z-index:0; }
#onlineCounter { position:absolute; top:10px; right:10px; font-weight:bold; font-size:1.2em; background: rgba(0,0,0,0.4); padding:5px 10px; border-radius:8px; z-index:2; }
.player { border:2px solid #ccc; padding:10px; margin:10px; display:inline-block; width:200px; background: rgba(0,0,0,0.6); vertical-align:top; border-radius:12px; position:relative; z-index:1; }
.player img.character { width:120px; height:auto; margin-top:10px; border-radius:8px; }
.bar { height:20px; background:#4caf50; margin-top:5px; transition:width 0.5s; border-radius:6px; }
.dice { margin-top:10px; height:60px; }
.bonus { font-size:0.9em; color:#ffd700; margin-top:5px; text-align:left; }
button { padding:10px 20px; margin-top:10px; cursor:pointer; border-radius:8px; background-color: rgba(255,255,255,0.2); border:1px solid #fff; color:white; font-weight:bold; transition: background-color 0.3s; }
button:hover { background-color: rgba(255,255,255,0.4); }
.modeButtons { margin:20px 0; }
.characters-selection { display:flex; justify-content:center; gap:10px; margin-bottom:15px; flex-wrap:wrap; }
.characters-selection img { width:60px; cursor:pointer; border:2px solid transparent; border-radius:6px; transition: transform 0.2s, border-color 0.2s; }
.characters-selection img:hover { transform: scale(1.1); border-color: gold; }
.characters-selection img.selected { border-color: gold; }
pre#log { text-align:left; max-height:300px; overflow:auto; background: rgba(0,0,0,0.6); padding:10px; border:1px solid #ccc; color:#fff; border-radius:8px; margin-top:20px; }
</style>
</head>
<body>
<div class="overlay"></div>
<h1>Fight Game - Pino Collection</h1>
<div id="onlineCounter">Online: 0</div>

<!-- Mode Selection -->
<div class="modeButtons">
  <h3>Select Mode:</h3>
  <button id="btnWallet">Connect Wallet</button>
  <button id="btnDemo">Demo</button>
</div>

<!-- Character Selection -->
<div class="characters-selection" id="characters">
  <img src="img/Beast.png" alt="Beast" data-name="Beast">
  <img src="img/Clown.png" alt="Clown" data-name="Clown">
  <img src="img/Cyclope.png" alt="Cyclope" data-name="Cyclope">
  <img src="img/Giant.png" alt="Giant" data-name="Giant">
  <img src="img/Hero.png" alt="Hero" data-name="Hero">
  <img src="img/Kongo.png" alt="Kongo" data-name="Kongo">
  <img src="img/Pirate.png" alt="Pirate" data-name="Pirate">
  <img src="img/Sailor.png" alt="Sailor" data-name="Sailor">
  <img src="img/Taurus.png" alt="Taurus" data-name="Taurus">
  <img src="img/WereWolf.png" alt="WereWolf" data-name="WereWolf">
</div>

<!-- Players -->
<div id="players">
  <div class="player" id="player1">
    <h2>Waiting...</h2>
    <div class="bonus">No bonus</div>
    <p>HP: <span class="hp">20</span></p>
    <div class="bar" style="width:100%"></div>
    <img class="character" src="img/Beast.png" alt="Character">
    <img class="dice" src="img/dice1.png" alt="Dice">
  </div>
  <div class="player" id="player2">
    <h2>Waiting...</h2>
    <div class="bonus">No bonus</div>
    <p>HP: <span class="hp">20</span></p>
    <div class="bar" style="width:100%"></div>
    <img class="character" src="img/Beast.png" alt="Character">
    <img class="dice" src="img/dice1.png" alt="Dice">
  </div>
</div>

<pre id="log"></pre>

<script>
const ws = new WebSocket(`ws://${location.host}`);
let myPlayerId = null;
let myCharacter = "Beast";
let players = [];

const charImgs = document.querySelectorAll("#characters img");
charImgs.forEach(img => {
  img.addEventListener("click", ()=> {
    charImgs.forEach(i=>i.classList.remove("selected"));
    img.classList.add("selected");
    myCharacter = img.dataset.name;
    // Aggiorna immagine lato client
    const pEl = myPlayerId===1?document.getElementById("player1"):document.getElementById("player2");
    pEl.querySelector(".character").src=`img/${myCharacter}.png`;
  });
});

function joinGame(mode){
  ws.send(JSON.stringify({ type:"join", mode, character:myCharacter }));
  document.getElementById("btnDemo").disabled = true;
  document.getElementById("btnWallet").disabled = true;
}

document.getElementById("btnDemo").addEventListener("click", ()=> joinGame("demo"));
document.getElementById("btnWallet").addEventListener("click", ()=> joinGame("wallet"));

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if(data.type==="online"){
    document.getElementById("onlineCounter").innerText = "Online: "+data.count;
  }
  if(data.type==="startBattle"){
    players = data.players;
    myPlayerId = players[0].character ? 1 : 2; // assegna id
    alert("Partita pronta! Sei Player "+myPlayerId);
    startBattle();
  }
  if(data.type==="battleAction"){
    // qui aggiorni azioni in tempo reale
  }
}

function startBattle(){
  const logEl = document.getElementById("log");
  logEl.textContent = "ðŸŒ€ Battle Started!\n";
}
</script>
</body>
</html>